import numpy as np
from libs.data_extraction import normalize_albumine, urea_to_bun

# Start and stop minutes of the time window  taken in consideration
TIME_WINDOW_START = 2 * 24 * 60 # from day 3
TIME_WINDOW_STOP = 5 * 24 * 60 # to day 5

creatinine_codes = [
    1020000600,2020000600,3020000600,
    4020000600,5020000600,6020000600
]

urine_output_codes = [
    1010010000,2010010000,3010010000,
    4010010000,5010010000,6010010000
]

def min(num):
    return np.quantile(num, q=0.1)
def max(num):
    return np.quantile(num, q=0.9)
AGG_FNC = [np.nanmean] # , np.nanstd

lab_config = {
    'albumin': {
        'idx': [
            1024000512,2024000340,3024001802,
            4024002341,5024001802,6024002862],
        'post_fnc': normalize_albumine},
    'potassium': {
        'idx': [
            1020000500,2020000500,3020000500,
            4020000500,5020000500,6020000500],
        'post_fnc': None},
    'hematocrit': {
        'idx': [
            1020000100,2020000100,3020000100,
            4020000100,5020000100,6020000100],
        'post_fnc': None},
    'ph': {
        'idx': [
            1020000300,2020000300,3020000300,
            4024001491,5020000300,6020000300],
        'vmin': 6, 'vmax': 8,
        'post_fnc': None},
    'bun': {
        'idx': [
            1020004100,2020004100,3020004100,
            4020004100,5024001806,5020004100,6020004100],
        'post_fnc': urea_to_bun},
    'creatinine': {
        'idx': [   
            1020000600,2020000600,3020000600,
            4020000600,5020000600,6020000600],
        'post_fnc': None},
    'bicarbonate': {
        'idx': [
            1020004200,2020004200,3020004200,
            51020004200,6020004200,4024001495,4024002678,
            1024000605, 
            2024000290, # 2024000434 venus 
            3024001976,3024002041,3024005910,
            4024002678,
            5024002041,
            6020004200],
        'post_fnc': None}
}

vitals_config = {
    'spo2': {'codes': [
        1000004000,2000004000,3000004000,4000004000,5000004000,6000004000
        ],
             'vmin': 0, 'vmax': 100,
             'aggfunc': [np.nanmean]},
    'heart_rate': {'codes': [
        1000000200,2000000200,3000000200,4000000200,5000000200,6000000200
        ],
          'vmin': 20, 'vmax': 220,
            'aggfunc': [np.nanmean]},
    'sbp': {'codes': [
        1000000600,2000000600,3000000600,4000000600,5000000600,6000000600,
        1000000100,2000000100,3000000100,4000000100,5000000100,6000000100
        ],
           'vmin': 60, 'vmax': 200,
            'aggfunc': [np.nanmean]},
    'mbp': {'codes': [
        1000000610,2000000610,3000000610,4000000610,5000000610,6000000610,
        1000000110,2000000110,3000000110,4000000110,5000000110,6000000110
        ],
           'vmin': 40, 'vmax': 180,
            'aggfunc': [np.nanmean]},
    'dbp': {'codes': [
        1000000620,2000000620,3000000620,4000000620,5000000620,6000000620,
        1000000120,2000000120,3000000120,4000000120,5000000120,6000000120
        ],
           'vmin': 30, 'vmax': 130,
            'aggfunc': [np.nanmean]},
    'resp_rate': {'codes': [
        1000000300,2000000300,3000000300,4000000300,5000000300,6000000300,
        1000000310,2000000310,3000000310,4000000310,5000000310,6000000310,
        1000000320,2000000320,3000000320,4000000320,5000000320,6000000320,
        1000000330,2000000330,3000000330,4000000330,5000000330,6000000330,
        1000005600,2000005600,3000005600,4000005600,5000005600,6000005600
        ],
            'vmin': 5, 'vmax': 60,
            'aggfunc': [np.nanmean]},
}

crrt_idx = [
    1000001380,1000005666, 
    2000001380,2000005666,
    3000001380,3000005666,
    4000001380,4000005666,
    5000001380,5000005666,
    6000001380,6000005666
]
sepsi_codes = ('995.92','785.52','R65.21','R65.20','A41.9')

# comorbidities_config = {
#     'diabetes': {
#         'icd': ('E08', 'E09', 'E10', 'E11', 'E13', 'E23', '249', '250'),
#         'to_exclude': None},
#     'heart_failure': {
#         'icd': ('I50', 'I51', 'I11', 'I25.8', 'I27.8', 'I13.2', 'I43', 'I46','428'),
#         'to_exclude': None},
#     'hypertension': {
#         'icd': ("I10", "401", "402", "I15","I13", "I11",'I12', 'I14', 'I16'),
#         'to_exclude': None},
#     'chronic_kidney_disease': {
#         'icd': (
#             '585', 
#             'D63', 
#             'I13.0', 'I13.1', 'I13.2', #'I13.11', 'I13.10',
#             'O10.32', 'O10.33', 'O10.3', 'O10.311', 'O10.312', 'O10.313', 'O10.319', 
#             'E08.22', 'E10.22', 'E11.22', 'E11.21', 
#             'N17', 'N19', 'N26', 'N28', 'N25',
#             'N18', 'N18.9', 'N18.1', 'N18.2', 'N18.3', 'N18.31', 'N18.32', 'N18.4', 'N18.5'),
#         'to_exclude': ["585.6","585.6/2"]},
#     'rrt': {
#         'icd': ('N18.6', 'Z99.2'),
#         'to_exclude': None
#     }
# }

comorbidities_config = {
    'diabetes': {
        'icd': (
            '250', '648', '249',
            'E08', 'E09', 'E10', 'E11', 'E12', 'E13'),
        'to_exclude': None},
    'heart_failure': {
        'icd': (
            '428.0', '428.1', '428.2', '428.3', '428.4', '428.9', '398.91',
            'I11', 'I13', 'I25', 'I42', 'I43', 'I44', 'I46', 'I50', 
            ),
        'to_exclude': None},
    'hypertension': {
        'icd': (
            '401.0','401.1','401.9','437.2','402.00','402.10','402.90',
            '405.09','405.19','402.01','402.11','402.91','403.10','403.00',
            '403.90','405.01','405.11','405.91','403.01','403.11','403.91',
            '404.00','404.10','404.90','404.01','404.11','404.91','404.02',
            '404.12','404.92','404.03','404.13','404.93','642.0','642.1',
            '642.2','642.7','642.9',
            'I10','I15','I16'),
        'to_exclude': None},
    'chronic_kidney_disease': {
        'icd': (
            '585.1','585.2','585.3','585.4','585.5','585.6','585.9',
            'I12','N01','N13','N02','N03','N14','N04','N05','N15','N06',
            'N07','N18','N08','N11','N19','N25','N26','N27','N28','N29'
            ),
        'to_exclude': ["585.6","585.6/2"]},
    'rrt': {
        'icd': ('N18.6', 'Z99.2'),
        'to_exclude': None
    }
}